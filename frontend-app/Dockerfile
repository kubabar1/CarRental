FROM node:16
ENV APP_HOME=/usr/app/
WORKDIR $APP_HOME
COPY . $APP_HOME/$APP_DIR

ARG AUTH_SERVICE_PROTOCOL
ARG BOOKING_SERVICE_PROTOCOL
ARG RATING_SERVICE_PROTOCOL
ARG STORAGE_STUB_SERVICE_PROTOCOL
ARG USER_SERVICE_PROTOCOL
ARG VEHICLE_SERVICE_PROTOCOL
ARG AUTH_SERVICE_HOSTNAME
ARG BOOKING_SERVICE_HOSTNAME
ARG RATING_SERVICE_HOSTNAME
ARG STORAGE_STUB_SERVICE_HOSTNAME
ARG USER_SERVICE_HOSTNAME
ARG VEHICLE_SERVICE_HOSTNAME
ARG AUTH_SERVICE_PORT
ARG BOOKING_SERVICE_PORT
ARG RATING_SERVICE_PORT
ARG STORAGE_STUB_SERVICE_PORT
ARG USER_SERVICE_PORT
ARG VEHICLE_SERVICE_PORT
ARG AUTH_SERVICE_CONTEXT
ARG BOOKING_SERVICE_CONTEXT
ARG RATING_SERVICE_CONTEXT
ARG STORAGE_STUB_SERVICE_CONTEXT
ARG USER_SERVICE_CONTEXT
ARG VEHICLE_SERVICE_CONTEXT
ARG FRONTEND_APP_PROTOCOL
ARG FRONTEND_APP_HOSTNAME
ARG FRONTEND_APP_PORT
ARG FRONTEND_APP_CONTEXT

RUN yarn clean -a -f
RUN yarn install
RUN yarn compile

ENTRYPOINT ["yarn", "deploy"]