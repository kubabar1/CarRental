FROM node:16
ENV APP_HOME=/usr/app/
WORKDIR $APP_HOME
COPY . $APP_HOME/$APP_DIR

# IMPORTANT - for kubernetess deployment set proper values
ARG API_PROTOCOL="http"
ARG API_HOSTNAME="localhost"
ARG API_PORT="30008"

# IMPORTANT - for kubernetess deployment set proper values
ENV FRONTEND_APP_PROTOCOL="http"
ENV FRONTEND_APP_HOSTNAME="localhost"
ENV FRONTEND_APP_PORT="30449"
ENV FRONTEND_APP_CONTEXT=""


ENV AUTH_SERVICE_PROTOCOL="$API_PROTOCOL"
ENV BOOKING_SERVICE_PROTOCOL="$API_PROTOCOL"
ENV RATING_SERVICE_PROTOCOL="$API_PROTOCOL"
ENV STORAGE_STUB_SERVICE_PROTOCOL="$API_PROTOCOL"
ENV USER_SERVICE_PROTOCOL="$API_PROTOCOL"
ENV VEHICLE_SERVICE_PROTOCOL="$API_PROTOCOL"

ENV AUTH_SERVICE_HOSTNAME="$API_HOSTNAME"
ENV BOOKING_SERVICE_HOSTNAME="$API_HOSTNAME"
ENV RATING_SERVICE_HOSTNAME="$API_HOSTNAME"
ENV STORAGE_STUB_SERVICE_HOSTNAME="$API_HOSTNAME"
ENV USER_SERVICE_HOSTNAME="$API_HOSTNAME"
ENV VEHICLE_SERVICE_HOSTNAME="$API_HOSTNAME"

ENV AUTH_SERVICE_PORT="$API_PORT"
ENV BOOKING_SERVICE_PORT="$API_PORT"
ENV RATING_SERVICE_PORT="$API_PORT"
ENV STORAGE_STUB_SERVICE_PORT="$API_PORT"
ENV USER_SERVICE_PORT="$API_PORT"
ENV VEHICLE_SERVICE_PORT="$API_PORT"

ENV AUTH_SERVICE_CONTEXT="/auth-service"
ENV BOOKING_SERVICE_CONTEXT="/booking-service"
ENV RATING_SERVICE_CONTEXT="/rating-service"
ENV STORAGE_STUB_SERVICE_CONTEXT="/storage-service-stub"
ENV USER_SERVICE_CONTEXT="/user-service"
ENV VEHICLE_SERVICE_CONTEXT="/vehicle-service"

RUN yarn install
RUN yarn compile

ENTRYPOINT ["yarn","deploy"]