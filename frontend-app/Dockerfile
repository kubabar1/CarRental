FROM node:16
ENV APP_HOME=/usr/app/
WORKDIR $APP_HOME
COPY . $APP_HOME/$APP_DIR

ENV AUTH_SERVICE_PROTOCOL="http"
ENV BOOKING_SERVICE_PROTOCOL="http"
ENV RATING_SERVICE_PROTOCOL="http"
ENV STORAGE_STUB_SERVICE_PROTOCOL="http"
ENV USER_SERVICE_PROTOCOL="http"
ENV VEHICLE_SERVICE_PROTOCOL="http"

ENV AUTH_SERVICE_HOSTNAME="localhost"
ENV BOOKING_SERVICE_HOSTNAME="localhost"
ENV RATING_SERVICE_HOSTNAME="localhost"
ENV STORAGE_STUB_SERVICE_HOSTNAME="localhost"
ENV USER_SERVICE_HOSTNAME="localhost"
ENV VEHICLE_SERVICE_HOSTNAME="localhost"

ENV AUTH_SERVICE_PORT="8080"
ENV BOOKING_SERVICE_PORT="8080"
ENV RATING_SERVICE_PORT="8080"
ENV STORAGE_STUB_SERVICE_PORT="8080"
ENV USER_SERVICE_PORT="8080"
ENV VEHICLE_SERVICE_PORT="8080"

ENV AUTH_SERVICE_CONTEXT="/auth-service"
ENV BOOKING_SERVICE_CONTEXT="/booking-service"
ENV RATING_SERVICE_CONTEXT="/rating-service"
ENV STORAGE_STUB_SERVICE_CONTEXT="/storage-service-stub"
ENV USER_SERVICE_CONTEXT="/user-service"
ENV VEHICLE_SERVICE_CONTEXT="/vehicle-service"

ENV FRONTEND_APP_PROTOCOL="http"
ENV FRONTEND_APP_HOSTNAME="localhost"
ENV FRONTEND_APP_PORT="3030"
ENV FRONTEND_APP_CONTEXT=""

RUN yarn install
RUN yarn compile

ENTRYPOINT ["yarn","deploy"]